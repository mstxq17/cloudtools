<!DOCTYPE html>
<html>
<!-- Mirrored from www.zi-han.net/theme/hplus/table_bootstrap.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 20 Jan 2016 14:20:03 GMT -->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudTools - 云端空间站</title>
    <meta name="keywords" content="CloudToos云端空间站致力于给专业人士带来极致贴切的服务">
    <meta name="description" content="CloudToos云端空间站致力于给专业人士带来极致贴切的服务">
    <link href="asset/css/bootstrap.min14ed.css?v=3.3.6" rel="stylesheet">
    <link href="asset/css/font-awesome.min93e3.css?v=4.4.0" rel="stylesheet">
    <link href="asset/css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
    <link href="asset/css/animate.min.css" rel="stylesheet">
    <link href="asset/css/style.min862f.css?v=4.1.0" rel="stylesheet">
    <link href="asset/css/my.css" rel="stylesheet">
</head>

<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="col-md-12 col-sm-12">
            <div id="dateSearch">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <i class="fa fa-search"></i> 查询条件
                    </div>
                    <div class="panel-body">
                        <form class="form-inline">
                            <div class="form-group">
                                <label for="username">用户名:</label>
                                <input type="text" id="userName" name="username" class="form-control" placeholder="请输入用户名">
                            </div>
                            <div class="form-group">
                                <label for="email">邮箱:</label>
                                <input type="text" id="email" name="email" class="form-control" placeholder="请输入用户名">
                            </div>
                            <div class="form-group">
                                <label for="role">角色:</label>
                                <select class="form-group" id="role">
                                	<option value="">--用户类型--</option>
                                    <option value="0">普通用户</option>
                                    <option value="1">管理员</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="date">日期:</label>
                                <input type="text" id="start" class="form-control" name="start_date" placeholder="开始日期">-
                                <input type="text" id="end" name="end_date" class="form-control" placeholder="结束日期">
                            </div>
                            <button type="button" class="btn btn-success" onclick="search()"> <i class="fa fa-search"></i> 搜索</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12 col-sm-12">
            <!-- 用户管理表格 -->
            <div id="toolbar">
                <div class="btn-group">
                    <button id="btn_add" type="button" class="btn btn-success btn-sm rightSize">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
                    </button>
                    <button id="btn_edit" type="button" class="btn btn-primary btn-sm rightSize">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
                    </button>
                    <button id="btn_delete" type="button" class="btn btn-danger btn-sm rightSize">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
                    </button>
                </div>
            </div>
            <div>
                <table id="user-table"></table>
            </div>
        </div>
    </div>
    </div>
    </div>
    <!-- End Panel Other -->
    </div>
</body>
<script src="asset/js/jquery.min.js?v=2.1.4"></script>
<script src="asset/js/bootstrap.min.js?v=3.3.6"></script>
<script src="asset/js/content.min.js?v=1.0.0"></script>
<script src="asset/js/qs.js"></script>
<script src="asset/js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
<script src="asset/js/plugins/layer/laydate/laydate.js"></script>
<script src="asset/js/plugins/layer/layer.js"></script>
<script src="asset/js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>
<script src="asset/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<script>
laydate.render({
    elem: '#start',
});
laydate.render({
    elem: '#end',
});


function formatDate(now) {
    var year = now.getFullYear();
    var month = now.getMonth() + 1;
    var date = now.getDate();
    var hour = now.getHours();
    var minute = now.getMinutes();
    var second = now.getSeconds();
    return year + "-" + month + "-" + date + " " + hour + ":" + minute + ":" + second;
}
    
// 处理后台数据
$(function() {

    //1.初始化Table
    var oTable = new TableInit();
    oTable.Init();

    //2.初始化Button的点击事件
    var oButtonInit = new ButtonInit();
    oButtonInit.Init();

});


var TableInit = function() {
    var oTableInit = new Object();
    //初始化Table
    oTableInit.Init = function() {
        $('#user-table').bootstrapTable({
            url: '../admin/api/findUsers', //请求后台的URL（*）
            method: 'post', //请求方式（*）
            dataType: "json", //返回类型
            // contentType: 'application/json,charset=utf-8',
            contentType: 'application/x-www-form-urlencoded',
            toolbar: '#toolbar', //工具按钮用哪个容器
            striped: true, //是否显示行间隔色
            cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true, //是否显示分页（*）
            sortable: false, //是否启用排序
            sortOrder: "asc", //排序方式
            queryParams: oTableInit.queryParams, //传递参数（*）
            sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
            pageNumber: 1, //初始化加载第一页，默认第一页
            pageSize: 5, //每页的记录行数（*）
            pageList: [5, 10, 25, 50, 100], //可供选择的每页的行数（*）
            paginationPreText: "上页", //分页栏的文字提示
            paginationNextText: "下页",
            paginationFirstText: "首页",
            paginationLastText: "尾页",
            //search: true, //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
            strictSearch: true,
            showColumns: true, //是否显示所有的列
            showRefresh: true, //是否显示刷新按钮
            minimumCountColumns: 2, //最少允许的列数
            clickToSelect: true, //是否启用点击选中行
            // height: 500,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            // 内容显示居中对齐
            uniqueId: "userId", //每一行的唯一标识，一般为主键列
            showToggle: true, //是否显示详细视图和列表视图的切换按钮
            cardView: false, //是否显示详细视图
            detailView: false, //是否显示父子表
            columns: [{
                    checkbox: true
                }, {
                    field: 'userId',
                    title: '用户ID',
                    align: 'center', // 控制列内容是否居中
                    sortable : true
                }, {
                    field: 'userName',
                    title: '用户名',
                    align: 'center',
                    sortable : true
                }, {
                    field: 'email',
                    align: 'center',
                    title: '用户邮箱'
                }, {
                    field: 'imagePath',
                    align: 'center',
                    title: '用户头像',
                    formatter: function(value ,row ,index){
                    	return '<img src="' + value +'" style="width:30px;height:30px">';
                    }
                }, {
                    field: 'registerTime',
                    align: 'center',
                    title: '注册时间',
                    sortable : true,
                    formatter: function(value, row, index){
                    	var date = new Date(value);
                    	return formatDate(date);
                    }
                },
                {
                    field: 'currentSize',
                    align: 'center',
                    title: '仓库使用',
                    sortable : true,
                    formatter: function(value, row, index){
                    	//console.log(row.maxSize);
                    	return Math.ceil(value/row.maxSize)+ "%";
                    }
                },
                {
                    field: 'maxSize',
                    align: 'center',
                    title: '容量',
                    sortable : true,
                    formatter: function(value, row, index){
                    	return (value/1024).toFixed(1)+"M";
                    }
                },
                {
                    field: 'permission',
                    align: 'center',
                    title: '仓库权限',
                    formatter: function(value, row, index){
                    	if(value == 0){
                    		return "可上传下载";
                    	}else if(value == 1){
                    		return "不可上传可下载";
                    	}else{
                    		return "不可上传下载";
                    	}
                    }
                },
                {
                    field: 'role',
                    align: 'center',
                    title: '角色',
                    formatter: function(value, row, index){
                    	if( value == 0){
                    		return "<font style='font-weight:500px;color: #5CC9F5'>普通用户</font>";
                    	}else{
                    		return "<font style='font-weight:500px;color: #FA0009'>管理员</font>";
                    	}
                    }
                },
            ]
        });
    };

    //得到查询的参数
    oTableInit.queryParams = function(params) {
    	var userName = $.trim($("#userName").val());
    	var email = $.trim($("#email").val());
    	var role = $.trim($("#role").val());
    	var start_date = $.trim($("#start").val());
    	var end_date = $.trim($("#end").val());
    	if(end_date != "" && end_date != undefined){
    		// 处理时间查询的问题
    		end_date += " 23:59:59";
    	}
        var temp = { //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
        	userName: userName,
        	email: email,
        	role: role,
        	start_date: start_date,
        	end_date: end_date,
            limit: params.limit, //页面大小
            offset: params.offset, //页码
            
        };
        return qs.stringify(temp);
    };
    return oTableInit;
};

var userTable = TableInit();
function search(){
	var index = layer.load(2); 
	$('#user-table').bootstrapTable('refresh',userTable.queryParams);
	layer.close(index);
	layer.msg("搜索完毕!", {icon:1, time:500});
}


var ButtonInit = function() {
    var oInit = new Object();
    var postdata = {};

    oInit.Init = function() {
        //初始化页面上面的按钮事件
    };

    return oInit;
};
</script>

</html>